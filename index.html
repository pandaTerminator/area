<!DOCTYPE html>
<html lang="en">

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        .hide {
            display: none;
        }
        
        .city-select-tab {
            border-bottom: 1px solid #ccc;
            border-right: 1px solid #ccc;
            border-top: 1px solid #ccc;
            width: 391px;
            height: 35px;
            background: #f0f0f0
        }
        
        .city-select-tab a {
            float: left;
            margin-bottom: -1px;
            padding: 3px 20px;
            width: 33px;
            border-left: 1px solid #ccc;
            border-bottom: 1px solid transparent;
            color: #4D4D4D;
            text-align: center;
            outline: 0;
            cursor: pointer;
        }
        
        .city-select-tab .current {
            background: #fff;
            border-bottom: 1px solid #fff;
            color: #f60;
        }
        
        .city-select {
            border: 1px #ccc solid;
            border-top: 0;
            padding: 10px 15px;
            width: 360px;
            background: #fff;
            font-size: 12px;
        }
        
        .city-title {
            margin-right: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #ccc;
            font-size: 14px;
            cursor: pointer;
        }
        
        .city-title:focus {
            outline: 0;
        }
        
        .has-city-title {
            color: #333
        }
        
        .city-select dl {
            line-height: 2;
            clear: both;
            padding: 3px 0;
            margin: 0
        }
        
        .city-select dl:after {
            clear: both;
            content: " ";
            display: block;
            font-size: 0;
            height: 0;
            visibility: hidden
        }
        
        .city-select dt {
            width: 25px;
            float: left;
            padding-right: 10px;
            font-weight: 700;
            text-align: right
        }
        
        .city-select dd {
            width: 320px;
            float: left;
            margin-left: 0
        }
        
        .city-select a {
            display: inline-block;
            color: #4D4D4D;
            padding: 0 10px;
            outline: 0;
            text-decoration: none;
            white-space: nowrap;
            margin-right: 2px
        }
        
        .city-select a:hover,
        .city-select a:focus {
            background-color: #fff8f3;
            border-radius: 2px;
            color: #f60
        }
        
        .city-select a.current {
            background-color: #f60;
            color: #fff;
            border-radius: 2px
        }
        
        .city-select-province dd,
        .city-select-city dd,
        .city-select-street dd,
        .city-select-district dd {
            width: 270px
        }
        
        .ks-overlay {
            position: absolute;
            left: -9999px;
            top: -9999px;
            z-index: 999999
        }
        
        .ks-overlay-hidden {
            visibility: hidden;
        }
        
        .bf-select {
            width: 390px;
            height: 30px;
            line-height: 30px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>

    <label for=""></label>
    <div class="bf-select"></div>


</body>
<script src="jquery.min.js"></script>
<script src="pinyin.js?2017"></script>
<script>
    +(function ($) {
        'use strict';
        var PluginName = 'ChooseArea';
        var html =
            '<div id="city-title" class="city-title">请选择省市区</div> <div class="ks-overlay ks-overlay-hidden" style="width: 300px; left: 8px; top: 37px;"><div class="ks-overlay-content"> <div class="city-select-warp"><div class="city-select-tab"><a class="current" attr-cont="city-province">省份</a><a class="" attr-cont="city-city">城市</a> <a class="" attr-cont="city-district">县区</a> </div> <div class="city-select-content"> <div class="city-select city-province"><dl class=fn-clear><dt>A-G<dd class="a-g"></dl><dl class=fn-clear><dt>H-K<dd class="h-k"></dl><dl class=fn-clear><dt>L-S<dd class="l-s"></dl><dl class=fn-clear><dt>T-Z<dd class="t-z"></dl></div><div class="city-select hide city-city"></div><div class="city-select hide city-district"></div></div></div></div></div>';


        // 拼音排序
        function pySegSort(arr, empty) {
            if (!String.prototype.localeCompare)
                return null;

            var letters = "*abcdefghjklmnopqrstwxyz".split('');
            var zh = "啊把差大额发噶哈级卡啦吗那哦爬器然啥他哇西呀咋".split('');

            var segs = [];
            var curr;
            $.each(letters, function (i, letter) {
                curr = {
                    letter: letter,
                    data: []
                };
                $.each(arr, function () {
                    if ((!zh[i - 1] || zh[i - 1].localeCompare(this.name) <= 0) && this.name.localeCompare(
                            zh[i] || '') == -1) {
                        curr.data.push(this);
                    }
                });
                if (empty || curr.data.length) {
                    segs.push(curr);
                    curr.data.sort(function (a, b) {
                        return a.name.localeCompare(b.name);
                    });
                }
            });
            return segs;
        }

        // 渲染省份
        var renderProvince = function (filted) {
            filted.forEach(function (value) {
                var html = '';
                var provinceData = value.zone;
                for (var i = 0; i < provinceData.length; i++) {
                    html += '<a title="' + provinceData[i].name + '" attr-id="' + provinceData[i].id +
                        '" href="javascript:;">' + provinceData[i].name + '</a>';
                }
                $('.city-select-content .city-province dl').find("." + value.className).html(html);
            });
        }

        function ChooseCity(element, areaData) {
            this.element = $(element);
            this.element.append(html);
            this.result = [];
            this.areaData = areaData;
            this.init();
            this.tab();
            this.clickShow();
            this.clickHide();
            this.areaClick();
        }

        // 获取一级菜单数据
        ChooseCity.prototype.init = function () {
            var html = '',
                regPosistion = [{
                        reg: /^[a-g]$/i,
                        className: 'a-g',
                        zone: []
                    },
                    {
                        reg: /^[h-k]$/i,
                        className: 'h-k',
                        zone: []
                    },
                    {
                        reg: /^[l-s]$/i,
                        className: 'l-s',
                        zone: []
                    },
                    {
                        reg: /^[t-z]$/i,
                        className: 't-z',
                        zone: []
                    }
                ];
            var filted = this.areaData.filter(function isPick(value) {
                return value.pid == 0;
            });
            var compositorData = pySegSort(filted);
            console.log(compositorData);
            compositorData.forEach(function (value) {
                for (var i = 0; i < regPosistion.length; i++) {
                    if (regPosistion[i].reg.test(value.letter)) {
                        regPosistion[i].zone = regPosistion[i].zone.concat(value.data);
                    }
                }
            });
            renderProvince(regPosistion);
        }

        // 点击显示地址栏
        ChooseCity.prototype.clickShow = function () {
            this.element.on('click', function () {
                $('.ks-overlay').removeClass('ks-overlay-hidden');
            });
        }

        // 点击隐藏地址栏
        ChooseCity.prototype.clickHide = function () {
            var targetArea = this.element;
            $(document).on('mouseup', function (e) {
                if (targetArea.has(e.target).length == 0 && !targetArea.is(e.target)) {
                    $('.ks-overlay').addClass('ks-overlay-hidden');
                }
            });
        }

        // 选择地址
        ChooseCity.prototype.areaClick = function () {
            this.element.on('click', ' .city-select dd a', function (e) {
                var _this = this,
                    target = e.target,
                    cont = $('.city-select-tab').find('.current').attr('attr-cont'),
                    id = $(target).attr('attr-id'),
                    tit = $(target).text();
                $('.' + cont).find('dd a').removeClass('current');
                $(target).addClass('current');
                switch (cont) {
                    case 'city-province':
                        var data = _this.areaData.filter(function isPick(value) {
                            return value.pid == id;
                        });
                        _this.renderArea('city-city', data);
                        _this.title(0, tit, id);
                        break;
                    case 'city-city':
                        var data = _this.areaData.filter(function isPick(value) {
                            return value.pid == id;
                        });
                        _this.renderArea('city-district', data);
                        _this.title(1, tit, id);
                        break;
                    case 'city-district':
                        _this.title(2, tit, id);
                        $('.ks-overlay').addClass('ks-overlay-hidden');
                        break;
                }
            }.bind(this));
        }

        // 渲染input当前地址
        ChooseCity.prototype.renderArea = function (position, data) {
            $('.city-select-content .city-select').addClass("hide");
            $('.city-select-content').find('.' + position).removeClass("hide").html('');
            $('.city-select-tab a').removeClass('current');
            $('.city-select-tab a').each(function (index, el) {
                if ($(el).attr('attr-cont') == position) {
                    $(el).addClass('current');
                }
            });
            var html = '',
                node = '';
            for (var i = 0; i < data.length; i++) {
                node += '<a title="' + data[i].name + '" attr-id="' + data[i].id +
                    '" href="javascript:;">' +
                    data[i].name +
                    '</a>';
            }
            html = '<dl class="fn-clear city-select-city"><dd>' + node + '</dd></dl>';
            $('.city-select-content').find('.' + position).append(html);
        }

        // 当选择省份改变时改变内容
        ChooseCity.prototype.destory = function () {
            $('.city-district .city-select-city dd').html('');
        }

        // tab切换
        ChooseCity.prototype.tab = function () {
            var titles = $('.bf-select').find('.city-select-tab a');
            var contents = $('.city-select-warp').find('.city-select-content .city-select');
            titles.each(function (index, el) {
                $(el).on('click', function () {
                    $(titles).removeClass('current').eq(index).addClass('current');
                    $(contents).addClass('hide').eq(index).removeClass('hide');
                });
            });
        }

        // 添加title
        ChooseCity.prototype.title = function (index, tit, id) {
            var html = '';
            if (this.result[index] == undefined) {
                this.result.push({
                    name: tit,
                    id: id
                });
            } else {
                if (this.result[index] != tit) {
                    this.result[index].name = tit;
                    this.result[index].id = id;
                    this.result = this.result.slice(0, index + 1);
                    if (index == 0) {
                        this.destory();
                    }
                }
            }
            var html = this.result.map(function (val) {
                return val.name;
            }).join('<span style="color:#cfcfcf">/</span>');
            $('.city-title').data('data-result', this.result);
            $('.city-title').html('').append(html).addClass('has-city-title');
        }

        // 注册插件
        $.fn[PluginName] = function (areaData) {
            return this.each(function () {
                if (!$.data(this, 'plugin_' + PluginName)) {
                    $.data(this, 'plugin_' + PluginName, new ChooseCity(this, areaData));
                }
            });
        };
    })(jQuery);
</script>
<script>
    $(function () {
        $.getJSON('newbenben.json', function (data) {
            $('.bf-select').ChooseArea(data);
        });
    });
</script>

</html>